# GOMFLOW Payment Services Production Environment Template
# Copy this file to .env.production and fill in the actual values

# ==============================================
# SHARED CONFIGURATION
# ==============================================

# Service Authentication (REQUIRED - Generate 32+ character secret)
SERVICE_SECRET=your_32_character_service_secret_key_here

# Database Configuration (REQUIRED)
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here

# Redis Configuration (Railway Redis add-on will provide this)
REDIS_URL=redis://red-xxxxx:6379

# Core API Configuration
CORE_API_URL=https://gomflow.com/api

# Environment
NODE_ENV=production

# ==============================================
# PAYMENTS SERVICE CONFIGURATION
# ==============================================

# PayMongo Configuration (Philippines) - REQUIRED
PAYMONGO_SECRET_KEY=sk_live_your_paymongo_secret_key_here
PAYMONGO_PUBLIC_KEY=pk_live_your_paymongo_public_key_here
PAYMONGO_WEBHOOK_SECRET=whsec_your_paymongo_webhook_secret_here
PAYMONGO_API_URL=https://api.paymongo.com/v1

# Billplz Configuration (Malaysia) - REQUIRED
BILLPLZ_API_KEY=your_billplz_live_api_key_here
BILLPLZ_COLLECTION_ID=your_billplz_collection_id_here
BILLPLZ_WEBHOOK_SECRET=your_billplz_webhook_secret_here
BILLPLZ_API_URL=https://www.billplz.com/api/v3

# Service URLs (Will be set after deployment)
WHATSAPP_SERVICE_URL=https://gomflow-whatsapp.railway.app
TELEGRAM_SERVICE_URL=https://gomflow-telegram.railway.app
DISCORD_SERVICE_URL=https://gomflow-discord.railway.app

# Webhook Configuration (Will be set after deployment)
WEBHOOK_BASE_URL=https://gomflow-payments.railway.app
PAYMONGO_WEBHOOK_URL=https://gomflow-payments.railway.app/api/webhooks/paymongo
BILLPLZ_WEBHOOK_URL=https://gomflow-payments.railway.app/api/webhooks/billplz

# Security Configuration
CORS_ORIGIN=https://gomflow.com,https://www.gomflow.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=100

# ==============================================
# SMART AGENT SERVICE CONFIGURATION  
# ==============================================

# OpenAI Configuration (REQUIRED - Ensure GPT-4 Vision access)
OPENAI_API_KEY=sk-your_openai_api_key_with_gpt4_vision_access
OPENAI_MODEL=gpt-4-vision-preview
OPENAI_MAX_TOKENS=1500
OPENAI_TEMPERATURE=0.1

# OCR Configuration
TESSERACT_LANG=eng+fil+msa
OCR_CONFIDENCE_THRESHOLD=60
OCR_TIMEOUT=30000
OCR_DPI=300

# Image Processing Configuration
MAX_IMAGE_SIZE=10485760
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/webp,image/heic
IMAGE_QUALITY=85
MAX_IMAGE_WIDTH=2048
MAX_IMAGE_HEIGHT=2048

# AI Detection Thresholds
MIN_CONFIDENCE_AUTO_MATCH=0.85
MIN_CONFIDENCE_SUGGEST=0.60
MIN_AMOUNT_THRESHOLD=1.00
MAX_AMOUNT_THRESHOLD=100000.00

# Processing Configuration
PROCESSING_TIMEOUT=60000
MAX_CONCURRENT_PROCESSES=5
CONFIDENCE_AUTO_APPROVE=85
CONFIDENCE_SUGGEST=60

# Queue Configuration
QUEUE_CONCURRENCY=3
QUEUE_MAX_ATTEMPTS=3
QUEUE_BACKOFF_DELAY=5000

# File Storage Configuration
UPLOAD_DIR=uploads
PROCESSED_DIR=processed
TEMP_DIR=temp
UPLOAD_MAX_SIZE=10485760

# Service URLs (Will be updated after payments deployment)
PAYMENT_SERVICE_URL=https://gomflow-payments.railway.app

# Security Configuration (Smart Agent specific)
RATE_LIMIT_MAX=50

# ==============================================
# MONITORING & LOGGING
# ==============================================

# Logging Configuration
LOG_LEVEL=info
LOG_FILE=logs/gomflow-services.log

# Performance Monitoring
PROCESSING_METRICS=true
PERFORMANCE_LOGGING=true
ENABLE_METRICS=true
METRICS_PORT=9090

# Health Check Configuration
HEALTH_CHECK_INTERVAL=30000

# Error Recovery Configuration
MAX_RETRIES=3
RETRY_DELAY=5000
CIRCUIT_BREAKER_THRESHOLD=10

# ==============================================
# OPTIONAL: MONITORING & ANALYTICS
# ==============================================

# Sentry Configuration (Optional but recommended)
SENTRY_DSN=your_sentry_dsn_here
SENTRY_ORG=your_sentry_org
SENTRY_PROJECT_PAYMENTS=gomflow-payments
SENTRY_PROJECT_SMART_AGENT=gomflow-smart-agent

# Security Monitoring (Optional)
WEBHOOK_IP_WHITELIST=103.10.129.0/24,52.77.249.0/24
ENCRYPT_PAYMENT_DATA=true
TRANSACTION_LOGGING=true
AUDIT_TRAIL=true
FRAUD_DETECTION=true

# ==============================================
# DEPLOYMENT NOTES
# ==============================================

# 1. REQUIRED API KEYS:
#    - PayMongo: Get from https://dashboard.paymongo.com/ (live keys)
#    - Billplz: Get from https://www.billplz.com/enterprise/ (live keys)  
#    - OpenAI: Ensure GPT-4 Vision access is enabled
#    - Supabase: Use service role key, not anon key

# 2. SECURITY CONSIDERATIONS:
#    - Generate a strong SERVICE_SECRET (32+ characters)
#    - Use live/production API keys, not test keys
#    - Ensure webhook secrets match provider configurations
#    - Verify CORS origins match your domain

# 3. DEPLOYMENT ORDER:
#    - Deploy both services first
#    - Update service URLs with actual Railway URLs  
#    - Configure webhooks with providers
#    - Test end-to-end payment flows

# 4. POST-DEPLOYMENT:
#    - Configure webhook URLs in PayMongo/Billplz dashboards
#    - Test payment processing with real transactions
#    - Set up monitoring and alerting
#    - Verify service-to-service communication

# 5. MONITORING:
#    - Check health endpoints: /api/health
#    - Monitor metrics endpoints: /api/metrics
#    - Review logs in Railway dashboard
#    - Set up Sentry for error tracking (recommended)